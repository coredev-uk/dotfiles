################################################
# coredev-uk/dotfiles
################################################

set $mod Mod4
font pango:SF Compact Rounded 10

# APP VARIABLES
set $browser    brave-beta
set $scrsht     flameshot gui
{% if yadm.hostname == "coreasahi" %}
set $term       MESA_GL_VERSION_OVERRIDE=3.3 MESA_GLSL_VERSION_OVERRIDE=330 kitty
{% else %}
set $term       alacritty
{% endif %}
set $rofi 		  rofi -show drun -theme $HOME/.config/rofi/config.rasi.new  # > /tmp/rofi.log 2>&1
set $picom      picom --config $HOME/.config/picom/picom.conf
set $bar        "~/.config/polybar/launch.sh"
set $notif      dunst
set $lock       betterlockscreen -l dimblur
set $lockms	    300
set $sleepms	  600
set $bge        feh --bg-fill --randomize ~/.wallpapers/*
set $rgbprof    orange-night

# RESIZE
set $center move position center
set $resize resize set 80 ppt 70 ppt

# GAPS
set $inner 10
set $outer 0
set $rounded 4

# SCRATCHPAD
bindsym $mod+c scratchpad show $center, resize set 80 ppt 70 ppt
bindsym $mod+Shift+c floating enable, move position $inner px $inner px, $resize, move scratchpad
bindsym $mod+Ctrl+c exec $term --class scratch 

# BORDER COLOURS
set $fg "#FFFFFF"
set $ac "#5865F2"
set $bg "#2e3035"

# STACKING
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split
title_align center
default_floating_border pixel 0
default_border pixel 0
for_window [class="^.*"] border pixel 0
border_radius $rounded

# GAPS
gaps inner $inner
gaps outer $outer
smart_gaps on

# GAPS COMMAND
bindsym $mod+g exec $picom; gaps inner all set $inner; gaps outer all set $outer
bindsym $mod+Shift+g exec $picom; gaps inner all set 0; gaps outer all set 0

new_window 1pixel
smart_borders on

# FLOATING
floating_modifier $mod
bindsym $mod+Shift+space floating toggle; $center

# CLASS                 BORDER  BACK    TEXT    INDICATOR
client.focused          $bg     $ac     $fg     $bg
client.focused_inactive $bg     $ac     $fg     $bg 
client.unfocused        $bg     $bg     $fg     $bg
client.urgent           $bg     $bg     $fg     $bg 
client.placeholder      $bg     $bg     $fg     $bg

# EXIT
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"

# RELOAD
bindsym $mod+Ctrl+r reload

# RESTART
bindsym $mod+Shift+r restart

# PASSWORD STUFF
bindsym Ctrl+Shift+space exec --no-startup-id 1password --quick-access

###############################################
##### WINDOW RULES ############################
###############################################

# floating windows
for_window [window_role="pop-up"] floating enable border normal
for_window [title="Lock Screen â€” 1Password"] floating enable resize set 800 500

# STEAM
for_window [class="^Steam$" title="^Friends$"] floating enable
for_window [class="^Steam$" title="^Friends List$"] floating enable
for_window [class="^Steam$" title="Steam - News"] floating enable
for_window [class="^Steam$" title=".* - Chat"] floating enable
for_window [class="^Steam$" title="^Settings$"] floating enable
for_window [class="^Steam$" title=".* - event started"] floating enable
for_window [class="^Steam$" title=".* CD key"] floating enable
for_window [class="^Steam$" title="^Steam - Self Updater$"] floating enable
for_window [class="^Steam$" title="^Screenshot Uploader$"] floating enable
for_window [class="^Steam$" title="^Steam Guard - Computer Authorization Required$"] floating enable
for_window [class="^Steam$" title="Steam Library Folders"] floating enable
for_window [class="^Steam$" title="Create or select new Steam library folder:"] floating enable
for_window [title="^Steam Keyboard$"] floating enable
for_window [class="steam_app_*"] floating disable
for_window [class="steam_app_242760"] floating enable
for_window [class="steam_app_1182480" title="Origin"] floating enable
for_window [class="steam_app_1091500" title="REDlauncher"] floating enable

# JETBRAINS
for_window [class="jetbrains-*" title="win0"] floating enable
for_window [class="jetbrains-*" title="splash"] floating enable
for_window [class="jetbrains-*" title="Welcome to *"] floating enable
for_window [class="^com-intellij-updater-Runner$" title="^Update$"] floating enable
for_window [instance="^sun-awt-X11-XDialogPeer$" title="^Complete Installation$"] floating enable

# OTHER
for_window [class="origin.exe"] floating enable
for_window [class="Lutris" title="Manage Runners"] floating enable
for_window [class="feh"] floating enable
for_window [class="gmod"] floating disable
for_window [class="bms_linux"] floating disable
for_window [instance="crx_nngceckbapebfimnlniiiahkandclblb"] floating enable
for_window [title="Web Remote" window_role="browser-window"] floating enable

# BROWSER
for_window [class="*edge*" window_role="pop-up"] floating enable
for_window [window_role="pop-up" title="*Outlook*"] floating disable
for_window [window_role="bubble"] floating enable

# WORKSPACE RULES
assign [class="steam_app_*"] 1
assign [class="discord"] 2

###############################################
##### TOOLS ###################################
###############################################

# MEDIA KEYS
#bindsym Super_L+C                   exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle
bindsym XF86AudioPlay               exec playerctl play-pause
bindsym XF86AudioPause              exec playerctl play-pause
bindsym XF86AudioNext               exec playerctl next
bindsym XF86AudioPrev               exec playerctl previous

# TERMINAL
bindsym $mod+Return     exec $term
# ROFI
bindsym $mod+space      exec --no-startup-id $rofi
# LOCK
bindsym $mod+l          exec $lock
# BROWSER
bindsym $mod+b          exec $browser
# SCREENSHOT
bindsym Ctrl+Print      exec $scrsht

###############################################
##### MOVEMENT ################################
###############################################

# KILL
bindsym $mod+q kill

# FOCUS CHANGE
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# MOVE FOCUSED
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# FOCUS DIFF MONITOR
bindsym $mod+Ctrl+Right focus output right
bindsym $mod+Ctrl+Left focus output left

# HORIZONTAL SPLIT
bindsym $mod+h split h

# VERTICAL SPLIT
bindsym $mod+v split v

# FULLSCREEN MODE
bindsym $mod+f fullscreen toggle

# FOCUS CHANGE (TILING/FLOATING)
bindsym $mod+d focus mode_toggle

# CHANGE TO PARENT
bindsym $mod+a focus parent


###############################################
##### WORKSPACES ##############################
###############################################

set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

# SWITCHING
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10

# MOVING
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10

# RESIZE BINDS
mode "resize" {
    bindsym j resize shrink width 10 px or 10 ppt
    bindsym k resize grow height 10 px or 10 ppt
    bindsym l resize shrink height 10 px or 10 ppt
    bindsym semicolon resize grow width 10 px or 10 ppt

    bindsym Left resize shrink width 10 px or 10 ppt
    bindsym Down resize grow height 10 px or 10 ppt
    bindsym Up resize shrink height 10 px or 10 ppt
    bindsym Right resize grow width 10 px or 10 ppt
    
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+r mode "default"
}

bindsym $mod+r mode "resize"

##### LAUNCH ##############################

exec --no-startup-id liquidctl --match hydro set fan speed 20
exec --no-startup-id 1password --silent
exec --no-startup-id xidlehook --not-when-fullscreen --not-when-audio --timer $lockms $lock '' --timer $sleepms 'systemctl suspend' '' 
#exec --no-startup-id openrgb --startminimized -p $rgbprof
exec --no-startup-id $notif
exec --no-startup-id steam -silent
exec --no-startup-id $browser --no-startup-window

exec dbus-update-activation-environment --all
exec gnome-keyring-daemon --start --components=secrets

exec_always --no-startup-id setxkbmap -layout gb
{% if yadm.hostname == "corearch" %}
exec_always --no-startup-id $picom 
{% endif %}
exec_always --no-startup-id $bge
exec_always --no-startup-id $bar
