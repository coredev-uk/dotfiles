
# Setting custom environment vars
set -x PLATFORM (uname -s)
set -x GPG_TTY (tty)
set -x STARSHIP_CONFIG "$HOME/.config/starship.toml"
set fish_greeting
set -x TERM "xterm-256color"

{% if yadm.os == "Linux" %}
# Start X at login
if status is-login
    if test -z "$DISPLAY" -a "$XDG_VTNR" = 1
        exec startx >> .xsession-errors 2>&1
    end
end
{% endif %}

{% if yadm.os == "Darwin" %}
fish_add_path /opt/homebrew/sbin
fish_add_path $HOME/.local/bin
fish_add_path $HOME/.cargo/bin

# Fix the annoying terminal database message
set -x PATH "/usr/local/bin:/opt/homebrew/bin:$PATH"	

# pnpm
set -gx PNPM_HOME "$HOME/Library/pnpm"
set -gx PATH "$PNPM_HOME" $PATH

if status is-interactive
    printf '\eP$f{"hook": "SourcedRcFileForWarp", "value": { "shell": "fish" }}\x9c'
end

{% endif %}

if status is-interactive
    # Commands to run in interactive sessions can go here 

    if command -v pfetch &> /dev/null
      pfetch
    end

    # Start ssh-agent if not running
    if test -z (pgrep ssh-agent | string collect)
        eval (ssh-agent -c) > /dev/null
        set -Ux SSH_AUTH_SOCK $SSH_AUTH_SOCK
        set -Ux SSH_AGENT_PID $SSH_AGENT_PID
        set -Ux SSH_AUTH_SOCK $SSH_AUTH_SOCK
    end

    # Alias Vscode Insiders if installed
    if command -v code-insiders &> /dev/null
     alias code="code-insiders"
    end
    
    set -Ux CARGO_NET_GIT_FETCH_WITH_CLI true

    . ~/.config/fish/functions/rprompt.fish
    . ~/.private-dots/secrets.fish

    alias ls='exa -F --group-directories-first'
    alias vim='nvim'
    alias vi='nvim'
    alias la='ls -la'
    alias paru='yay'
    alias yarn='corepack yarn'
end

starship init fish | source
